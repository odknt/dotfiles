#!/bin/bash

IFS=$'\t\n'

BASEDIR="/var/run/user/$(id -u)/ratpoison"
PIDFILE="systray${DISPLAY%.*}.pid"
BARPOS="$(xrandr | grep -o '+[0-9]*+[0-9]*' | head -n1)"

on_exit() {
  rm -f "$BASEDIR/$PIDFILE"
}

if [ -d "$BASEDIR" ]; then
  if [ -f "$BASEDIR/$PIDFILE" ]; then
      [ -x "/proc/$(< "$BASEDIR/$PIDFILE")" ] && kill -- "-$(cat "$BASEDIR/$PIDFILE")"
      while [ -f "$BASEDIR/$PIDFILE" ]; do
        sleep 0.1
      done
  fi
else 
  mkdir "$BASEDIR"
fi

echo "$$" > "$BASEDIR/$PIDFILE"

trap on_exit 0 1 2 3 15

stalonetray --geometry 6x1+2860+0 --kludges=fix_window_pos -bg '#101010' -i 20 --slot-size 20 --window-type dock

exit 0
# vim: sw=2
